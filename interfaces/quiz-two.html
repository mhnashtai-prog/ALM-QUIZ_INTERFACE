<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz: Time Traveler - INTUITY</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', 'Inter', -apple-system, sans-serif;
      background: #0d0d0d;
      color: white;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
      touch-action: pan-y;
    }

    .background {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle at 30% 20%, rgba(201, 169, 97, 0.08) 0%, transparent 50%),
                  radial-gradient(circle at 70% 80%, rgba(201, 169, 97, 0.06) 0%, transparent 45%),
                  #0d0d0d;
      z-index: 0;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
      position: relative;
      z-index: 2;
      padding: 0 1rem;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .top-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 0;
      position: sticky;
      top: 0;
      background: rgba(13, 13, 13, 0.8);
      backdrop-filter: blur(20px);
      z-index: 10;
      margin: 0 -1rem;
      padding-left: 1rem;
      padding-right: 1rem;
    }

    .back-btn, .home-btn {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border: 1px solid rgba(84, 84, 88, 0.25);
      border-radius: 0.75rem;
      padding: 0.625rem 1rem;
      color: #C9A961;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 0.375rem;
      text-decoration: none;
    }

    .back-btn:hover, .home-btn:hover {
      background: rgba(201, 169, 97, 0.15);
      border-color: rgba(201, 169, 97, 0.4);
      transform: translateY(-2px);
    }

    .logo {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      color: #C9A961;
      letter-spacing: 2px;
    }

    .quiz-header {
      text-align: center;
      padding: 1.5rem 0;
      margin-bottom: 1rem;
    }

    .quiz-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .quiz-subtitle {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.5);
      font-weight: 500;
    }

    .progress-section {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border: 1px solid rgba(84, 84, 88, 0.25);
      border-radius: 1rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .progress-text {
      text-align: center;
      font-size: 0.75rem;
      color: #8e8e93;
      margin-bottom: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }

    .progress-bar-bg {
      background: rgba(255, 255, 255, 0.05);
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 0.75rem;
    }

    .progress-bar-fill {
      background: linear-gradient(90deg, #C9A961 0%, rgba(201, 169, 97, 0.7) 100%);
      height: 100%;
      border-radius: 4px;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 10px rgba(201, 169, 97, 0.5);
    }

    .stats-row {
      display: flex;
      justify-content: space-around;
      font-size: 0.75rem;
      color: #8e8e93;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .stat-value {
      color: #C9A961;
      font-weight: 700;
    }

    .instruction-card {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border: 1px solid rgba(84, 84, 88, 0.25);
      border-radius: 1.25rem;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .instruction-text {
      font-size: 0.9375rem;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.5;
    }

    .timeline-container {
      background: rgba(28, 28, 30, 0.4);
      border: 1px solid rgba(84, 84, 88, 0.2);
      border-radius: 1rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .timeline-label {
      font-size: 0.6875rem;
      color: #8e8e93;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
      text-align: center;
      font-weight: 600;
    }

    .timeline {
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      margin-bottom: 1rem;
    }

    .timeline::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 2rem;
      right: 2rem;
      height: 2px;
      background: linear-gradient(90deg, #C9A961 0%, rgba(201, 169, 97, 0.3) 100%);
      transform: translateY(-50%);
    }

    .timeline-marker {
      position: relative;
      z-index: 1;
      text-align: center;
    }

    .timeline-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #C9A961;
      margin: 0 auto 0.25rem;
      box-shadow: 0 0 8px rgba(201, 169, 97, 0.5);
    }

    .timeline-time {
      font-size: 0.6875rem;
      color: #C9A961;
      font-weight: 600;
    }

    .activities-pool {
      margin-bottom: 1.5rem;
    }

    .pool-label {
      font-size: 0.75rem;
      color: #8e8e93;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
      text-align: center;
      font-weight: 600;
    }

    .activity-card {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border: 1px solid rgba(84, 84, 88, 0.25);
      border-radius: 0.875rem;
      padding: 0.875rem 1rem;
      margin-bottom: 0.625rem;
      cursor: grab;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      user-select: none;
      touch-action: none;
    }

    .activity-card:active {
      cursor: grabbing;
    }

    .activity-card.dragging {
      opacity: 0.5;
      transform: scale(0.95);
      cursor: grabbing;
    }

    .activity-card:hover:not(.placed) {
      background: rgba(201, 169, 97, 0.1);
      border-color: rgba(201, 169, 97, 0.3);
      transform: translateX(4px);
    }

    .activity-card.placed {
      opacity: 0.3;
      pointer-events: none;
    }

    .activity-emoji {
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .activity-text {
      font-size: 0.875rem;
      color: #e5e5e7;
      font-weight: 500;
      flex: 1;
    }

    .activity-time {
      font-size: 0.75rem;
      color: #8e8e93;
      font-weight: 600;
    }

    .drop-zones {
      display: grid;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .drop-zone {
      background: rgba(28, 28, 30, 0.4);
      border: 2px dashed rgba(84, 84, 88, 0.3);
      border-radius: 0.875rem;
      padding: 1rem;
      min-height: 70px;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .drop-zone::before {
      content: attr(data-position);
      position: absolute;
      top: 0.5rem;
      left: 0.75rem;
      font-size: 0.6875rem;
      color: #8e8e93;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .drop-zone.drag-over {
      background: rgba(201, 169, 97, 0.1);
      border-color: rgba(201, 169, 97, 0.5);
      border-style: solid;
      transform: scale(1.02);
    }

    .drop-zone.filled {
      background: rgba(28, 28, 30, 0.6);
      border-style: solid;
      border-color: rgba(84, 84, 88, 0.5);
    }

    .drop-zone.correct {
      background: rgba(29, 211, 192, 0.15);
      border-color: #1DD3C0;
      animation: celebrate 0.6s;
    }

    .drop-zone.wrong {
      background: rgba(239, 68, 68, 0.15);
      border-color: rgba(239, 68, 68, 0.6);
      animation: shake 0.5s;
    }

    @keyframes celebrate {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }

    .dropped-activity {
      background: rgba(28, 28, 30, 0.8);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 0.75rem;
      padding: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.625rem;
      flex: 1;
      cursor: pointer;
    }

    .dropped-activity:hover {
      background: rgba(201, 169, 97, 0.1);
      border-color: rgba(201, 169, 97, 0.3);
    }

    .remove-btn {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 0.5rem;
      padding: 0.375rem 0.625rem;
      color: rgba(239, 68, 68, 0.9);
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .remove-btn:hover {
      background: rgba(239, 68, 68, 0.25);
      transform: scale(1.05);
    }

    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .action-btn {
      background: rgba(201, 169, 97, 0.15);
      border: 1px solid rgba(201, 169, 97, 0.3);
      border-radius: 0.875rem;
      padding: 0.875rem 1rem;
      color: #C9A961;
      font-size: 0.875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-family: 'DM Sans', sans-serif;
    }

    .action-btn:hover:not(:disabled) {
      background: rgba(201, 169, 97, 0.25);
      border-color: rgba(201, 169, 97, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(201, 169, 97, 0.3);
    }

    .action-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }

    .action-btn.reset {
      background: rgba(84, 84, 88, 0.15);
      border-color: rgba(84, 84, 88, 0.3);
      color: #8e8e93;
    }

    .action-btn.reset:hover:not(:disabled) {
      background: rgba(84, 84, 88, 0.25);
      border-color: rgba(84, 84, 88, 0.5);
    }

    .feedback-box {
      background: rgba(28, 28, 30, 0.8);
      backdrop-filter: blur(40px);
      border: 1px solid rgba(84, 84, 88, 0.25);
      border-radius: 1rem;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      display: none;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .feedback-box.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .feedback-box.correct {
      background: rgba(29, 211, 192, 0.1);
      border-color: rgba(29, 211, 192, 0.3);
    }

    .feedback-box.wrong {
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.3);
    }

    .feedback-title {
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .feedback-box.correct .feedback-title {
      color: #1DD3C0;
    }

    .feedback-box.wrong .feedback-title {
      color: rgba(239, 68, 68, 0.9);
    }

    .feedback-text {
      font-size: 0.875rem;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.7);
    }

    .results-screen {
      display: none;
      text-align: center;
      padding: 2rem 0;
    }

    .results-screen.show {
      display: block;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .results-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      animation: bounce 1s;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    .results-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 1rem;
    }

    .score-display {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border: 1px solid rgba(84, 84, 88, 0.25);
      border-radius: 1.25rem;
      padding: 2rem;
      margin: 1.5rem 0;
    }

    .score-big {
      font-size: 3rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 0.5rem;
    }

    .score-ratio {
      font-size: 1.25rem;
      color: #8e8e93;
    }

    .results-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .result-stat {
      background: rgba(28, 28, 30, 0.4);
      border: 1px solid rgba(84, 84, 88, 0.2);
      border-radius: 0.875rem;
      padding: 1rem;
    }

    .result-stat-label {
      font-size: 0.6875rem;
      color: #8e8e93;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .result-stat-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: #C9A961;
    }

    .results-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 2rem;
    }

    @media (max-width: 480px) {
      .quiz-title {
        font-size: 1.25rem;
      }
      
      .timeline-time {
        font-size: 0.625rem;
      }
    }
  </style>
</head>
<body>
  <div class="background"></div>

  <div class="container">
    <!-- Top Navigation -->
    <div class="top-nav">
      <a href="../mode1-train-carousel.html" class="back-btn">
        ‚Üê Train
      </a>
      <div class="logo">INTUITY</div>
      <a href="../index.html" class="home-btn">
        üè† Home
      </a>
    </div>

    <!-- Quiz Content -->
    <div id="quizContent">
      <div class="quiz-header">
        <h1 class="quiz-title">
          <span>üåÖ</span>
          <span>Time Traveler</span>
        </h1>
        <p class="quiz-subtitle" id="characterName">Put the day in order!</p>
      </div>

      <!-- Progress Section -->
      <div class="progress-section">
        <div class="progress-text" id="progressText">Sequence 1 of 5</div>
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" id="progressBar" style="width: 20%"></div>
        </div>
        <div class="stats-row">
          <div class="stat-item">
            Score: <span class="stat-value" id="scoreValue">0</span>
          </div>
          <div class="stat-item">
            Perfect: <span class="stat-value" id="perfectValue">0</span>üèÜ
          </div>
          <div class="stat-item">
            Time: <span class="stat-value" id="timeValue">0:00</span>
          </div>
        </div>
      </div>

      <!-- Instructions -->
      <div class="instruction-card">
        <p class="instruction-text">
          üéØ Drag the activities into the correct time order!
        </p>
      </div>

      <!-- Timeline -->
      <div class="timeline-container">
        <div class="timeline-label">üìç Timeline</div>
        <div class="timeline">
          <div class="timeline-marker">
            <div class="timeline-dot"></div>
            <div class="timeline-time" id="startTime">6am</div>
          </div>
          <div class="timeline-marker">
            <div class="timeline-dot"></div>
            <div class="timeline-time">12pm</div>
          </div>
          <div class="timeline-marker">
            <div class="timeline-dot"></div>
            <div class="timeline-time">6pm</div>
          </div>
          <div class="timeline-marker">
            <div class="timeline-dot"></div>
            <div class="timeline-time" id="endTime">10pm</div>
          </div>
        </div>
      </div>

      <!-- Activities Pool -->
      <div class="activities-pool">
        <div class="pool-label">üé® Drag from here:</div>
        <div id="activitiesPool"></div>
      </div>

      <!-- Drop Zones -->
      <div class="drop-zones" id="dropZones"></div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="action-btn" id="checkBtn" onclick="checkOrder()" disabled>
          ‚úì Check Order
        </button>
        <button class="action-btn reset" onclick="resetActivity()">
          üîÑ Reset
        </button>
      </div>

      <!-- Feedback -->
      <div class="feedback-box" id="feedbackBox">
        <div class="feedback-title" id="feedbackTitle"></div>
        <div class="feedback-text" id="feedbackText"></div>
      </div>

      <!-- Next Button -->
      <button class="action-btn" id="nextBtn" onclick="nextSequence()" style="display: none; width: 100%;">
        Next Sequence ‚Üí
      </button>
    </div>

    <!-- Results Screen -->
    <div class="results-screen" id="resultsScreen">
      <div class="results-icon" id="resultsIcon">üéâ</div>
      <h2 class="results-title">Quiz Complete!</h2>
      
      <div class="score-display">
        <div class="score-big" id="finalScore">100</div>
        <div class="score-ratio" id="finalRatio">5/5 Perfect</div>
      </div>

      <div class="results-stats">
        <div class="result-stat">
          <div class="result-stat-label">Accuracy</div>
          <div class="result-stat-value" id="accuracyValue">100%</div>
        </div>
        <div class="result-stat">
          <div class="result-stat-label">Perfect</div>
          <div class="result-stat-value" id="perfectCountValue">5</div>
        </div>
        <div class="result-stat">
          <div class="result-stat-label">Time</div>
          <div class="result-stat-value" id="finalTimeValue">2:34</div>
        </div>
      </div>

      <div class="results-actions">
        <button class="action-btn" onclick="restartQuiz()">
          üîÑ Try Again
        </button>
        <button class="action-btn" onclick="window.location.href='../mode1-train-carousel.html'">
          ‚Üê Back to Train Carousel
        </button>
        <a href="../index.html" class="action-btn" style="text-align: center; display: block; text-decoration: none;">
          üè† Main Menu
        </a>
      </div>
    </div>
  </div>
  <script>
    // Quiz State
    let sequences = [];
    let currentSequenceIndex = 0;
    let score = 0;
    let perfectCount = 0;
    let startTime = Date.now();
    let currentSequence = null;
    let draggedElement = null;
    let touchStartX = 0;
    let touchStartY = 0;

    // Sample sequences data
    const sampleSequences = [
      {
        id: 1,
        activities: [
          { id: 'act1', text: 'wakes up', emoji: '‚è∞', time: '6:30am', order: 1 },
          { id: 'act2', text: 'brushes teeth', emoji: 'ü™•', time: '6:45am', order: 2 },
          { id: 'act3', text: 'has breakfast', emoji: 'üç≥', time: '7:00am', order: 3 },
          { id: 'act4', text: 'goes to school', emoji: 'üéí', time: '8:00am', order: 4 }
        ]
      },
      {
        id: 2,
        activities: [
          { id: 'act5', text: 'arrives at school', emoji: 'üè´', time: '8:30am', order: 1 },
          { id: 'act6', text: 'has lunch', emoji: 'üç±', time: '12:00pm', order: 2 },
          { id: 'act7', text: 'finishes classes', emoji: 'üìö', time: '3:30pm', order: 3 },
          { id: 'act8', text: 'comes home', emoji: 'üè†', time: '4:00pm', order: 4 }
        ]
      },
      {
        id: 3,
        activities: [
          { id: 'act9', text: 'does homework', emoji: '‚úçÔ∏è', time: '4:30pm', order: 1 },
          { id: 'act10', text: 'has dinner', emoji: 'üçΩÔ∏è', time: '6:30pm', order: 2 },
          { id: 'act11', text: 'watches TV', emoji: 'üì∫', time: '7:30pm', order: 3 },
          { id: 'act12', text: 'goes to bed', emoji: 'üò¥', time: '10:00pm', order: 4 }
        ]
      },
      {
        id: 4,
        activities: [
          { id: 'act13', text: 'gets dressed', emoji: 'üëï', time: '7:15am', order: 1 },
          { id: 'act14', text: 'packs bag', emoji: 'üéí', time: '7:30am', order: 2 },
          { id: 'act15', text: 'catches bus', emoji: 'üöå', time: '7:50am', order: 3 },
          { id: 'act16', text: 'enters classroom', emoji: 'üö™', time: '8:25am', order: 4 }
        ]
      },
      {
        id: 5,
        activities: [
          { id: 'act17', text: 'has a snack', emoji: 'üç™', time: '4:15pm', order: 1 },
          { id: 'act18', text: 'plays outside', emoji: '‚öΩ', time: '5:00pm', order: 2 },
          { id: 'act19', text: 'takes a shower', emoji: 'üöø', time: '8:00pm', order: 3 },
          { id: 'act20', text: 'reads a book', emoji: 'üìñ', time: '9:30pm', order: 4 }
        ]
      }
    ];

    // Load quiz data
    function loadQuizData() {
      const stored = sessionStorage.getItem('quizData');
      
      if (stored) {
        const quizData = JSON.parse(stored);
        document.getElementById('characterName').textContent = `${quizData.character}'s Daily Routine`;
        
        // Generate sequences from routine data if available
        if (quizData.verbs && quizData.verbs.length >= 4) {
          sequences = generateSequencesFromData(quizData.verbs);
        } else {
          sequences = sampleSequences;
        }
      } else {
        sequences = sampleSequences;
      }

      loadSequence();
      startTimer();
    }

    function generateSequencesFromData(verbs) {
      // Split verbs into chunks of 4
      const generated = [];
      for (let i = 0; i < Math.min(5, Math.floor(verbs.length / 4)); i++) {
        const chunk = verbs.slice(i * 4, (i + 1) * 4);
        generated.push({
          id: i + 1,
          activities: chunk.map((verb, idx) => ({
            id: `act${i * 4 + idx + 1}`,
            text: verb.verb + ' ' + verb.object,
            emoji: verb.emoji,
            time: verb.object.includes(':') ? verb.object : `${7 + idx}:00am`,
            order: idx + 1
          }))
        });
      }
      return generated.length > 0 ? generated : sampleSequences;
    }

    function loadSequence() {
      currentSequence = sequences[currentSequenceIndex];
      
      // Update progress
      const progress = ((currentSequenceIndex + 1) / sequences.length) * 100;
      document.getElementById('progressText').textContent = `Sequence ${currentSequenceIndex + 1} of ${sequences.length}`;
      document.getElementById('progressBar').style.width = `${progress}%`;

      // Update timeline times
      const times = currentSequence.activities.map(a => a.time);
      document.getElementById('startTime').textContent = times[0];
      document.getElementById('endTime').textContent = times[times.length - 1];

      // Shuffle and render activities
      const shuffled = [...currentSequence.activities].sort(() => Math.random() - 0.5);
      renderActivities(shuffled);
      renderDropZones();

      // Reset UI
      document.getElementById('feedbackBox').classList.remove('show', 'correct', 'wrong');
      document.getElementById('checkBtn').disabled = true;
      document.getElementById('nextBtn').style.display = 'none';
    }

    function renderActivities(activities) {
      const pool = document.getElementById('activitiesPool');
      pool.innerHTML = activities.map(activity => `
        <div class="activity-card" 
             draggable="true" 
             data-id="${activity.id}"
             data-order="${activity.order}"
             id="card-${activity.id}">
          <div class="activity-emoji">${activity.emoji}</div>
          <div class="activity-text">${activity.text}</div>
          <div class="activity-time">${activity.time}</div>
        </div>
      `).join('');

      // Add drag listeners
      document.querySelectorAll('.activity-card').forEach(card => {
        // Mouse events
        card.addEventListener('dragstart', handleDragStart);
        card.addEventListener('dragend', handleDragEnd);
        
        // Touch events for mobile
        card.addEventListener('touchstart', handleTouchStart, { passive: false });
        card.addEventListener('touchmove', handleTouchMove, { passive: false });
        card.addEventListener('touchend', handleTouchEnd, { passive: false });
      });
    }

    function renderDropZones() {
      const zones = document.getElementById('dropZones');
      const positions = ['1st', '2nd', '3rd', '4th'];
      
      zones.innerHTML = positions.map((pos, idx) => `
        <div class="drop-zone" 
             data-position="${pos}"
             data-slot="${idx + 1}"
             id="zone-${idx + 1}">
        </div>
      `).join('');

      // Add drop listeners
      document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.addEventListener('dragover', handleDragOver);
        zone.addEventListener('drop', handleDrop);
        zone.addEventListener('dragleave', handleDragLeave);
      });
    }

    // Drag & Drop Handlers (Mouse)
    function handleDragStart(e) {
      if (this.classList.contains('placed')) return;
      draggedElement = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.innerHTML);
    }

    function handleDragEnd(e) {
      this.classList.remove('dragging');
    }

    function handleDragOver(e) {
      if (e.preventDefault) {
        e.preventDefault();
      }
      e.dataTransfer.dropEffect = 'move';
      
      if (!this.classList.contains('filled')) {
        this.classList.add('drag-over');
      }
      return false;
    }

    function handleDragLeave(e) {
      this.classList.remove('drag-over');
    }

    function handleDrop(e) {
      if (e.stopPropagation) {
        e.stopPropagation();
      }
      e.preventDefault();

      this.classList.remove('drag-over');

      if (!draggedElement || this.classList.contains('filled')) return;

      const activityId = draggedElement.dataset.id;
      const activityOrder = draggedElement.dataset.order;
      const activityEmoji = draggedElement.querySelector('.activity-emoji').textContent;
      const activityText = draggedElement.querySelector('.activity-text').textContent;
      const activityTime = draggedElement.querySelector('.activity-time').textContent;

      // Create dropped activity
      this.innerHTML = `
        <div class="dropped-activity" data-id="${activityId}" data-order="${activityOrder}">
          <div class="activity-emoji">${activityEmoji}</div>
          <div class="activity-text">${activityText}</div>
          <div class="activity-time">${activityTime}</div>
        </div>
        <button class="remove-btn" onclick="removeActivity('${this.id}', '${activityId}')">‚úï</button>
      `;

      this.classList.add('filled');
      draggedElement.classList.add('placed');
      
      // Check if all zones filled
      checkIfComplete();

      return false;
    }

    // Touch Handlers (Mobile)
    function handleTouchStart(e) {
      if (this.classList.contains('placed')) return;
      
      e.preventDefault();
      draggedElement = this;
      
      const touch = e.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
      
      this.classList.add('dragging');
      this.style.position = 'fixed';
      this.style.zIndex = '1000';
      this.style.left = touch.clientX - this.offsetWidth / 2 + 'px';
      this.style.top = touch.clientY - this.offsetHeight / 2 + 'px';
    }

    function handleTouchMove(e) {
      if (!draggedElement) return;
      e.preventDefault();
      
      const touch = e.touches[0];
      draggedElement.style.left = touch.clientX - draggedElement.offsetWidth / 2 + 'px';
      draggedElement.style.top = touch.clientY - draggedElement.offsetHeight / 2 + 'px';
    }

    function handleTouchEnd(e) {
      if (!draggedElement) return;
      e.preventDefault();
      
      const touch = e.changedTouches[0];
      const dropZone = document.elementFromPoint(touch.clientX, touch.clientY);
      
      // Reset dragged element position
      draggedElement.style.position = '';
      draggedElement.style.zIndex = '';
      draggedElement.style.left = '';
      draggedElement.style.top = '';
      draggedElement.classList.remove('dragging');
      
      // Check if dropped on a valid zone
      if (dropZone && dropZone.classList.contains('drop-zone') && !dropZone.classList.contains('filled')) {
        const activityId = draggedElement.dataset.id;
        const activityOrder = draggedElement.dataset.order;
        const activityEmoji = draggedElement.querySelector('.activity-emoji').textContent;
        const activityText = draggedElement.querySelector('.activity-text').textContent;
        const activityTime = draggedElement.querySelector('.activity-time').textContent;

        dropZone.innerHTML = `
          <div class="dropped-activity" data-id="${activityId}" data-order="${activityOrder}">
            <div class="activity-emoji">${activityEmoji}</div>
            <div class="activity-text">${activityText}</div>
            <div class="activity-time">${activityTime}</div>
          </div>
          <button class="remove-btn" onclick="removeActivity('${dropZone.id}', '${activityId}')">‚úï</button>
        `;

        dropZone.classList.add('filled');
        draggedElement.classList.add('placed');
        
        checkIfComplete();
      }
      
      draggedElement = null;
    }

    function removeActivity(zoneId, activityId) {
      const zone = document.getElementById(zoneId);
      const card = document.getElementById(`card-${activityId}`);
      
      zone.innerHTML = '';
      zone.classList.remove('filled', 'correct', 'wrong');
      card.classList.remove('placed');
      
      checkIfComplete();
    }

    function checkIfComplete() {
      const filledZones = document.querySelectorAll('.drop-zone.filled').length;
      document.getElementById('checkBtn').disabled = filledZones !== 4;
    }

    function checkOrder() {
      const zones = document.querySelectorAll('.drop-zone');
      let allCorrect = true;
      let correctCount = 0;

      zones.forEach((zone, idx) => {
        const dropped = zone.querySelector('.dropped-activity');
        if (dropped) {
          const droppedOrder = parseInt(dropped.dataset.order);
          const expectedOrder = idx + 1;
          
          if (droppedOrder === expectedOrder) {
            zone.classList.add('correct');
            zone.classList.remove('wrong');
            correctCount++;
          } else {
            zone.classList.add('wrong');
            zone.classList.remove('correct');
            allCorrect = false;
          }
        }
      });

      // Show feedback
      const feedbackBox = document.getElementById('feedbackBox');
      feedbackBox.classList.add('show');
      
      if (allCorrect) {
        feedbackBox.classList.add('correct');
        feedbackBox.classList.remove('wrong');
        document.getElementById('feedbackTitle').innerHTML = '‚úì Perfect! +25 points';
        document.getElementById('feedbackText').textContent = 'You got the sequence exactly right! The activities are in perfect chronological order.';
        
        score += 25;
        perfectCount++;
        createConfetti();
      } else {
        feedbackBox.classList.add('wrong');
        feedbackBox.classList.remove('correct');
        document.getElementById('feedbackTitle').innerHTML = `‚ö†Ô∏è Almost! ${correctCount}/4 correct`;
        document.getElementById('feedbackText').textContent = 'Some activities are out of order. Check the times and try rearranging!';
        
        score += correctCount * 5;
      }

      updateStats();
      
      // Show next button only if perfect
      if (allCorrect) {
        document.getElementById('checkBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'block';
      }
    }

    function resetActivity() {
      // Clear all drop zones
      document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.innerHTML = '';
        zone.classList.remove('filled', 'correct', 'wrong');
      });

      // Reset all activity cards
      document.querySelectorAll('.activity-card').forEach(card => {
        card.classList.remove('placed');
      });

      // Hide feedback
      document.getElementById('feedbackBox').classList.remove('show', 'correct', 'wrong');
      document.getElementById('checkBtn').disabled = true;
    }

    function createConfetti() {
      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.style.position = 'fixed';
          confetti.style.width = '10px';
          confetti.style.height = '10px';
          confetti.style.background = ['#C9A961', '#1DD3C0', '#8B5CF6'][Math.floor(Math.random() * 3)];
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.top = '-10px';
          confetti.style.zIndex = '9999';
          confetti.style.borderRadius = '50%';
          confetti.style.pointerEvents = 'none';
          
          const animation = confetti.animate([
            { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
            { transform: `translateY(100vh) rotate(${Math.random() * 720}deg)`, opacity: 0 }
          ], {
            duration: 3000,
            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
          });
          
          document.body.appendChild(confetti);
          animation.onfinish = () => confetti.remove();
        }, i * 50);
      }
    }

    function updateStats() {
      document.getElementById('scoreValue').textContent = score;
      document.getElementById('perfectValue').textContent = perfectCount;
    }

    function startTimer() {
      setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById('timeValue').textContent = 
          `${minutes}:${seconds.toString().padStart(2, '0')}`;
      }, 1000);
    }

    function nextSequence() {
      if (currentSequenceIndex < sequences.length - 1) {
        currentSequenceIndex++;
        loadSequence();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        showResults();
      }
    }

    function showResults() {
      document.getElementById('quizContent').style.display = 'none';
      document.getElementById('resultsScreen').classList.add('show');

      const accuracy = Math.round((perfectCount / sequences.length) * 100);
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;

      document.getElementById('finalScore').textContent = score;
      document.getElementById('finalRatio').textContent = `${perfectCount}/${sequences.length} Perfect`;
      document.getElementById('accuracyValue').textContent = `${accuracy}%`;
      document.getElementById('perfectCountValue').textContent = perfectCount;
      document.getElementById('finalTimeValue').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

      // Set results icon
      if (accuracy === 100) {
        document.getElementById('resultsIcon').textContent = 'üèÜ';
        document.getElementById('resultsScreen').querySelector('.results-title').textContent = 'Perfect Score!';
        createConfetti();
        createConfetti();
      } else if (accuracy >= 80) {
        document.getElementById('resultsIcon').textContent = 'üéâ';
      } else if (accuracy >= 60) {
        document.getElementById('resultsIcon').textContent = 'üëç';
      } else {
        document.getElementById('resultsIcon').textContent = 'üí™';
        document.getElementById('resultsScreen').querySelector('.results-title').textContent = 'Keep Practicing!';
      }
    }

    function restartQuiz() {
      currentSequenceIndex = 0;
      score = 0;
      perfectCount = 0;
      startTime = Date.now();

      document.getElementById('quizContent').style.display = 'block';
      document.getElementById('resultsScreen').classList.remove('show');

      loadSequence();
    }

    // Initialize quiz on load
    window.addEventListener('DOMContentLoaded', () => {
      loadQuizData();
    });
  </script>
</body>
</html>
